<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cybersecurity Management Suite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Navigation will be inserted by navigation.js -->

  <main class="app-main">
    <header class="page-header">
      <div class="header-content">
        <h1>Cybersecurity Management Suite</h1>
        <p>STIG Analysis and POAM Management Tool</p>
      </div>
    </header>

    <section class="instructions">
      <div class="instructions-content">
        <h2>How to Use This Application</h2>

        <div class="instruction-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Import STIG Files</h3>
            <p>Start by navigating to the <strong>STIG Analysis</strong> page and importing your STIG CKL/CKLB files. The application will automatically parse and analyze the vulnerabilities, mapping them to NIST controls.</p>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-content">
            <h3>Export CCI/STIG Mappings</h3>
            <p>After analyzing your STIG files, use the <strong>"Export Mappings"</strong> button to save the CCI/STIG mappings to your local system. Choose JSON format for best compatibility with POAM creation.</p>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-content">
            <h3>Create POAMs with the Wizard</h3>
            <p>Navigate to the <strong>POAM Creation Wizard</strong> to create Plans of Action & Milestones. The wizard will guide you through:</p>
            <ul>
              <li>Importing your exported CCI/STIG mappings</li>
              <li>Selecting specific NIST controls</li>
              <li>Choosing individual vulnerabilities that need remediation</li>
              <li>Configuring automatic milestone generation</li>
              <li>Customizing POAM details before creation</li>
            </ul>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-content">
            <h3>Manage Your POAMs</h3>
            <p>Use the <strong>POAM Management</strong> page to view, track, and manage your created POAMs. You can monitor progress, update milestones, and export your data.</p>
          </div>
        </div>

        <div class="workflow-note">
          <h3>üí° Recommended Workflow</h3>
          <p><strong>STIG Analysis ‚Üí Export Mappings ‚Üí POAM Wizard ‚Üí POAM Management</strong></p>
          <p>This workflow ensures all vulnerabilities are properly analyzed and only eligible items (Open, Failed, Not Reviewed) are included in POAMs.</p>
        </div>
      </div>
    </section>

    <!-- Enhanced Upload Guide -->
    <section class="instructions">
      <div class="instructions-content">
        <h2>Upload Guide (Best Results)</h2>

        <div class="instruction-step">
          <div class="step-number">A</div>
          <div class="step-content">
            <h3>Upload the CCI List First</h3>
            <p>On the <strong>STIG Analysis</strong> page, upload the official CCI list XML (e.g., <code>U_CCI_List.xml</code>) before importing any checklists. This loads comprehensive CCI ‚Üí NIST mappings so controls are associated immediately.</p>
            <ul>
              <li><strong>Why:</strong> Ensures more complete NIST mappings across all STIG rules.</li>
              <li><strong>One-time per session:</strong> Once loaded, the mappings are stored and reused.</li>
            </ul>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-number">B</div>
          <div class="step-content">
            <h3>Prefer Importing One Checklist at a Time</h3>
            <p>While bulk uploads are supported, importing <strong>1 checklist at a time</strong> is preferred for performance and reliability in the browser environment.</p>
            <ul>
              <li><strong>Performance:</strong> Large multi-file imports can be slow and memory-heavy in the browser.</li>
              <li><strong>Reliability:</strong> Single-file imports avoid hitting localStorage size limits and reduce parsing load.</li>
            </ul>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-number">C</div>
          <div class="step-content">
            <h3>If You Do Bulk Uploads</h3>
            <p>Bulk imports will work, but the app may compact stored data to fit browser storage limits.</p>
            <ul>
              <li><strong>Compaction:</strong> Large text fields in vulnerabilities may be trimmed in storage. This does not affect current session analysis.</li>
              <li><strong>Tip:</strong> After importing, use <strong>Export to Excel</strong> or <strong>Export Mappings</strong> to save your results externally.</li>
              <li><strong>POAM Safety:</strong> POAMs and milestones are always saved with priority, even if vulnerabilities are compacted.</li>
            </ul>
          </div>
        </div>

        <div class="instruction-step">
          <div class="step-number">D</div>
          <div class="step-content">
            <h3>Troubleshooting</h3>
            <ul>
              <li><strong>QuotaExceededError:</strong> The browser‚Äôs localStorage is full. The app automatically compacts STIG data and retries. Consider importing fewer files at once, or export and clear data.</li>
              <li><strong>Unmapped Controls:</strong> Ensure the CCI list is uploaded first. Some rules may not contain CCIs or explicit NIST references and can remain unmapped.</li>
              <li><strong>Missing Data After Refresh:</strong> POAMs and milestones persist. If STIG rows weren‚Äôt stored due to size, re-import the checklist or export results after analysis.</li>
              <li><strong>Performance Tips:</strong> Close other heavy tabs, and import one checklist at a time for faster processing.</li>
            </ul>
          </div>
        </div>

        <div class="workflow-note">
          <h3>üìå Summary</h3>
          <p><strong>1) Upload CCI XML ‚Üí 2) Import one checklist ‚Üí 3) Analyze and export ‚Üí 4) Create and manage POAMs</strong></p>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Client-side only. All data compiled to JSON files in /data folder for consistent loading.</small>
  </footer>

  <!-- Core Systems (load first) -->
  <script src="scripts/app-state.js"></script>
  <script src="scripts/data-manager.js"></script>
  <script>
    // Debug script loading
    console.log('üì¶ Scripts loaded - DataManager:', !!window.DataManager, 'AppState:', !!window.AppState);
    if (window.DataManager) {
      console.log('üì¶ DataManager type:', typeof window.DataManager);
      console.log('üì¶ DataManager ready method:', typeof window.DataManager.ready);
    }
  </script>
  
  <!-- UI Framework and Components -->
  <link rel="stylesheet" href="components/ui-components.css">
  <script src="components/ui-framework.js"></script>
  <script src="components/icon-library.js"></script>
  <script src="components/ui-components.js"></script>
  <!-- Progressive Button Migration (opt-in via data-ui-button) -->
  <script src="components/button-migration.js"></script>
  
  <!-- Navigation and UI components -->
  <script src="components/navigation.js"></script>
  <script src="components/status-messages.js"></script>
  
  <!-- Application initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        console.log('üèÅ Instructions page loaded');

        // Initialize the application state
        await AppState.initialize();

      } catch (error) {
        console.error('‚ùå Failed to initialize application:', error);
      }
    });
  </script>
</body>
</html>